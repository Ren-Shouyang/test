# Trend-Aligner: a retention time modeling-based feature alignment method for untargeted LC-MS-based data analysis


## Highlights
- **Novelty:** Trend-Aligner models the RT shift as global RT shift and local RT shift. The global RT shift represents the systematic chromatographic condition changes across samples, while the local RT shift represents the differential response of compounds with different physicochemical properties to chromatographic condition variations. The global RT shift is minimized through locally-weighted scatterplot smoothing regression, and the local RT shift is modeled on latent factor model. 
- **Accuracy:** In the reference-based accuracy benchmarking, Trend-Aligner demonstrated superior performance by outperforming 11 widely-used alignment algorithms from prominent platforms including OpenMS, MZmine2, XCMS, AntDAS, DeepRTAlign, and M2S, achieving the best alignment accuracy, precision and recall across eight metabolomic and five proteomic datasets.
- **Reliability:** In the application-oriented utility validation, Trend-Aligner achieved a 13.9% increase in the number of identified peptides compared to MaxQuant while maintaining stable and precise quantification accuracy. 
- **Efficiency** Although Trend-Aligner requires iterative optimization for LOWESS bandwidth self-adaptation and involves complex parameter computation in latent factor models via beam search and kernel density estimation, Trend-Aligner's processing speed still ranked among the top tier of all currently popular algorithms. The average runtime of Trend-Aligner was around 30 seconds.
- **Open source:** We open-sourced Trend-Aligner under a permissive license to promote the accuracy of MS data analysis more broadly.
- **Dataset:** We manually annotated the feature datasets for eight metabolomic and five proteomic datasets, including 4419 concensus feature and 85084 feature peak with associated m/z, RT, and peak area information. These comprehensively annotated datasets serve as valuable benchmarks for evaluating feature detection, quantification, and alignment accuracy.

## Datasets
The data distributions of evaluation datasets, feature lists, alignment results, manual annotated results, RAB results, runtime, AUV results and parameters settings are available in [Zenodo](https://doi.org/10.5281/zenodo.15054538).


## Setup
1. Prepare the python environment based on your system and hardware.
   
2. Install the dependencies. Here we use ROOT_PATH to represent the root path of Trend-Aligner.
   
    ```cd ROOT_PATH```
   
    ```pip install -r requirements.txt```



## Run Trend-Aligner

### Supported formats
Trend-Aligner support both the specialized formats of feature list files generated by some popular software (e.g. OpenMS, MaxQuant23, etc.) and any CSV/TXT files containing the information of m/z, RT and intensity

### Demos
The demos include alignment example of MTBLS733(QE HF) MetaPro feature lists and EC-H OpenMS feature lists.

```
Trend-Aligner-master
├── demo
│   ├── example
│   ├── openms_example
│   ├── openms_example_converted
│   ├── openms_result
│   ├── result
```


- To run the demo:

```cd ROOT_PATH```

```python demo/align_demo.py```

Feature alignment results are saved in ```result``` and ```openms_result``` folder.


## Citation

Cite our paper at:
```
@article{wang2023,
  title={G-Aligner: a graph-based feature alignment method for untargeted LC--MS-based metabolomics},
  author={Wang, Ruimin and Lu, Miaoshan and An, Shaowei and Wang, Jinyin and Yu, Changbin},
  journal={BMC bioinformatics},
  volume={24},
  number={1},
  pages={431},
  year={2023},
  publisher={Springer},
  doi={10.1186/s12859-023-05525-4}
}
```

## License

Trend-Aligner is an open-source tool, using [***Mulan Permissive Software License，Version 2 (Mulan PSL v2)***](http://license.coscl.org.cn/MulanPSL2)

